<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>golang cheatsheet</title>
<script id="hp_same_"></script><script id="hp_done_"></script><link rel="stylesheet" href="../css/main.css?version=2021082402"><link rel="stylesheet" href="../css/prism.css?version=2021082402"></head>

<body>
    <script>
        if (!location.hostname.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)
            && location.hostname !== 'localhost'
        ) {
            if (location.protocol === 'http:') {
                // https 跳转
                location.href = 'https:' + location.href.substring(window.location.protocol.length)
            } else if (location.pathname === '/') {
                // 静态跳转
                if ((/#\/[^/]+/).test(location.hash)) {
                    location.href = `https://${location.hostname}/docs/${location.hash.substring(2)}.html`
                } else {
                    location.href = `https://${location.hostname}/docs/`
                }
            }
        }
        let isHtml = true
    </script>

    <div id="loading" class="hide" data-cs-theme="light"></div>
    <div id="top-nav" data-cs-theme="light">
        <div class="top-nav__wrapper">
            <div id="go-back" onclick="history.go(-1)">返回</div>
            <a id="go-home" href="./index.html">首页</a>

        </div>
    </div>
    <div id="main">
        <div id="sheet-wrapper">
            <div id="sheet-title">
                <h1>golang<span> cheatsheet</span></h1>
            </div>
            <div id="sheet-body">
                
                            <div class="h2-section" >
                                
                                
                            <div class="sheet-section"  data-position="580|0|0">
                                <div class="section-title"><h3 id="id-272">Credits</h3></div>
                                <div class="section-body">
                                    <p>大部分例子来源于<a title="A Tour of Go" href="http://tour.golang.org/" target="_blank">A Tour of Go</a>, 是<code>Go</code>非常优秀的入门教程，如果你是新手，建议你先看看这个教程。</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|0">
                                <div class="section-title"><h3 id="id-273">简述</h3></div>
                                <div class="section-body">
                                    <ul><li>  命令式语言
</li><li>  静态类型
</li><li>  类似于<code>C</code>的语法标记（但括号较少且没有分号），其结构类似于<code>Oberon-2</code>
</li><li>  编译为原生代码（无虚拟机）
</li><li>  没有类，但有带方法的结构
</li><li>  接口
</li><li>  没有实现继承。 不过，有<a title="类型嵌入" href="http://golang.org/doc/effective%5Fgo.html#embedding" target="_blank">类型嵌入</a>。
</li><li>  函数是最重要的部分
</li><li>  函数可以返回多个值
</li><li>  闭包
</li><li>  指针，但没有指针算术
</li><li>  内置并发元支持：<code>Goroutine</code>和<code>Channels</code>
</li></ul>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|136">
                                <div class="section-title"><h3 id="id-274">Hello World</h3></div>
                                <div class="section-body">
                                    <p>File <code>hello.go</code>:</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello Go"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>$ go run hello.go</code></p>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-279">操作符</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-275">算术运算</h3></div>
                                <div class="section-body">
                                    
            <table>
                <thead class="hide">
                    <tr>
                        <th>Operator</th><th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td><code>+</code></td><td>加</td></tr><tr><td><code>-</code></td><td>减</td></tr><tr><td><code>*</code></td><td>乘</td></tr><tr><td><code>/</code></td><td>除</td></tr><tr><td><code>%</code></td><td>余</td></tr><tr><td><code>&amp;</code></td><td>按位与</td></tr><tr><td><code>|</code></td><td>按位或</td></tr><tr><td><code>^</code></td><td>按位异或</td></tr><tr><td><code>&amp;^</code></td><td>与非，<code>a &amp;^ b == a &amp; (^b)</code></td></tr><tr><td><code>&lt;&lt;</code></td><td>左移，<code>*2</code></td></tr><tr><td><code>&gt;&gt;</code></td><td>右移，<code>/2</code></td></tr>
                </tbody>
            </table>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-276">对比</h3></div>
                                <div class="section-body">
                                    
            <table>
                <thead class="hide">
                    <tr>
                        <th>Operator</th><th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td><code>==</code></td><td>等于</td></tr><tr><td><code>!=</code></td><td>不等于</td></tr><tr><td><code>&lt;</code></td><td>小于</td></tr><tr><td><code>&lt;=</code></td><td>小于等于</td></tr><tr><td><code>&gt;</code></td><td>大于</td></tr><tr><td><code>&gt;=</code></td><td>大于等于</td></tr>
                </tbody>
            </table>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|354">
                                <div class="section-title"><h3 id="id-277">逻辑运算</h3></div>
                                <div class="section-body">
                                    
            <table>
                <thead class="hide">
                    <tr>
                        <th>Operator</th><th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td><code>&amp;&amp;</code></td><td>与</td></tr><tr><td><code>||</code></td><td>或</td></tr><tr><td><code>!</code></td><td>非</td></tr>
                </tbody>
            </table>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|541">
                                <div class="section-title"><h3 id="id-278">其他</h3></div>
                                <div class="section-body">
                                    
            <table>
                <thead class="hide">
                    <tr>
                        <th>Operator</th><th>Description</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td><code>&amp;</code></td><td>指针地址 / 创建指针</td></tr><tr><td><code>*</code></td><td>取消引用指针</td></tr><tr><td><code>&lt;-</code></td><td>发送/接收运算</td></tr>
                </tbody>
            </table>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-281">变量声明</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-280"></h3></div>
                                <div class="section-body">
                                    <p>类型在标识符之后</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> foo <span class="token builtin">int</span> <span class="token comment">// 未初始化声明</span>
<span class="token keyword">var</span> foo <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">42</span> <span class="token comment">// 初始化声明</span>
<span class="token keyword">var</span> foo<span class="token punctuation">,</span> bar <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">1302</span> <span class="token comment">// 多变量声明和初始化</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">42</span> <span class="token comment">// 类型推断</span>
foo <span class="token operator">:=</span> <span class="token number">42</span> <span class="token comment">// 简写，仅在func主体中，省略var关键字，类型始终为隐式</span>
<span class="token keyword">const</span> constant <span class="token operator">=</span> <span class="token string">"这是一个常量"</span>

<span class="token comment">//iota 递增计数，从0开始(遇到const归0)</span>
<span class="token comment">//未初始化变量，默认等于上一变量</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
    <span class="token boolean">_</span> <span class="token operator">=</span> <span class="token boolean">iota</span>
    a
    b
    c <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token boolean">iota</span>
    d
<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">// 1 2 (0 is skipped)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token comment">// 8 16 (2^3, 2^4)</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-287">函数</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-282">init()函数</h3></div>
                                <div class="section-body">
                                    <ul><li>  init 函数是用于程序执行前做包的初始化的函数，比如初始化包里的变量等
</li><li>  每个包可以拥有多个 init 函数
</li><li>  包的每个源文件也可以拥有多个 init 函数
</li><li>  同一个包中多个 init 函数的执行顺序 go 语言没有明确的定义(说明)
</li><li>  不同包的 init 函数按照包导入的依赖关系决定该初始化函数的执行顺序
</li><li>  init 函数不能被其他函数调用，而是在 main 函数执行之前，自动被调用
</li></ul>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-283">main()函数</h3></div>
                                <div class="section-body">
                                    <p>Go语言程序的默认入口函数(主函数)</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//函数体</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|242">
                                <div class="section-title"><h3 id="id-284">函数定义</h3></div>
                                <div class="section-body">
                                    <h4>一个简单的函数</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">functionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<h4>带参数函数（同样的，类型在标识符之后）</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">functionName</span><span class="token punctuation">(</span>param1 <span class="token builtin">string</span><span class="token punctuation">,</span> param2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<h4>同类型的多个参数</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">functionName</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span> param2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<h4>返回值类型声明</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">functionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">42</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>返回多个参数</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">returnMulti</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">"foobar"</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> x<span class="token punctuation">,</span> str <span class="token operator">=</span> <span class="token function">returnMulti</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h4>只需通过 return 返回多个命名结果</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">returnMulti2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    n <span class="token operator">=</span> <span class="token number">42</span>
    s <span class="token operator">=</span> <span class="token string">"foobar"</span>
    <span class="token comment">// n 和 s 将被返回</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> x<span class="token punctuation">,</span> str <span class="token operator">=</span> <span class="token function">returnMulti2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|257">
                                <div class="section-title"><h3 id="id-285">函数作为值和闭包</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 给函数分配名称</span>
    add <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b
    <span class="token punctuation">}</span>
    <span class="token comment">// 通过名称调用函数</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>闭包，字面作用域：定义函数时，函数可以访问作用域内的值</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">scope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">{</span>
    outer_var <span class="token operator">:=</span> <span class="token number">2</span>
    foo <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> outer_var<span class="token punctuation">}</span>
    <span class="token keyword">return</span> foo
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">another_scope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">{</span>
    <span class="token comment">// 无法编译，因为outer_var和foo不在本作用域内</span>
    outer_var <span class="token operator">=</span> <span class="token number">444</span>
    <span class="token keyword">return</span> foo
<span class="token punctuation">}</span>
</code></pre>
<h4>闭包</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    outer_var <span class="token operator">:=</span> <span class="token number">2</span>
    inner <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
        outer_var <span class="token operator">+=</span> <span class="token number">99</span> <span class="token comment">// 外部作用域的outer_var被修改</span>
        <span class="token keyword">return</span> outer_var
    <span class="token punctuation">}</span>
    <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> inner<span class="token punctuation">,</span> outer_var <span class="token comment">// 返回 inner func 和 变化后的 outer_var 101</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|1022">
                                <div class="section-title"><h3 id="id-286">可变参数函数</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">adder</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 	<span class="token comment">// 6</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">adder</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 18</span>

	nums <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">adder</span><span class="token punctuation">(</span>nums<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">// 60</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>通过在最后一个参数的类型名称前使用<code>...</code>，接受零个或多个参数。</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">adder</span><span class="token punctuation">(</span>args <span class="token operator">...</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
	total <span class="token operator">:=</span> <span class="token number">0</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> args <span class="token punctuation">{</span> <span class="token comment">// 变量所有参数</span>
		total <span class="token operator">+=</span> v
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> total
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-293">类型</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-288">内置类型</h3></div>
                                <div class="section-body">
                                    <h4>值类型</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token builtin">bool</span>

<span class="token builtin">string</span>

<span class="token builtin">int</span>  <span class="token builtin">int8</span>  <span class="token builtin">int16</span>  <span class="token builtin">int32</span>  <span class="token builtin">int64</span>
<span class="token builtin">uint</span> <span class="token builtin">uint8</span> <span class="token builtin">uint16</span> <span class="token builtin">uint32</span> <span class="token builtin">uint64</span> <span class="token builtin">uintptr</span>

<span class="token builtin">byte</span> <span class="token comment">// 等同于uint8，常用来处理ascii字符</span>

<span class="token builtin">rune</span> <span class="token comment">// rune 等同于int32，常用来处理unicode或utf-8字符</span>

<span class="token builtin">float32</span> <span class="token builtin">float64</span>

<span class="token builtin">complex64</span> <span class="token builtin">complex128</span>
</code></pre>
<h4>引用类型（指针类型）</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style="">slice   <span class="token operator">--</span> 序列数组<span class="token punctuation">(</span>最常用<span class="token punctuation">)</span>
<span class="token keyword">map</span>     <span class="token operator">--</span> 映射
<span class="token keyword">chan</span>    <span class="token operator">--</span> 管道
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-289">内置函数</h3></div>
                                <div class="section-body">
                                    
            <table>
                <thead class="hide">
                    <tr>
                        <th>方法</th><th>描述</th>
                    </tr>
                </thead>
                <tbody>
                <tr><td>append</td><td>用来追加元素到数组、slice 中,返回修改后的数组、slice</td></tr><tr><td>close</td><td>主要用来关闭 channel</td></tr><tr><td>delete</td><td>从 map 中删除 key 对应的 value</td></tr><tr><td>panic</td><td>停止常规的 goroutine （panic 和 recover：用来做错误处理）</td></tr><tr><td>recover</td><td>允许程序定义 goroutine 的 panic 动作</td></tr><tr><td>real</td><td>返回 complex 的实部 （complex、real imag：用于创建和操作复数）</td></tr><tr><td>imag</td><td>返回 complex 的虚部</td></tr><tr><td>make</td><td>用来分配内存，返回 Type 本身(只能应用于 slice, map, channel)</td></tr><tr><td>new</td><td>用来分配内存，主要用来分配值类型，比如 int、struct。返回指向 Type 的指针</td></tr><tr><td>cap</td><td>capacity 是容量的意思，用于返回某个类型的最大容量（只能用于切片和 map）</td></tr><tr><td>copy</td><td>用于复制和连接 slice，返回复制的数目</td></tr><tr><td>len</td><td>来求长度，比如 string、array、slice、map、channel ，返回长度</td></tr><tr><td>print、println</td><td>底层打印函数，在部署环境中建议使用 fmt 包</td></tr>
                </tbody>
            </table>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|571">
                                <div class="section-title"><h3 id="id-290">结构 Struct</h3></div>
                                <div class="section-body">
                                    <p>go 没有类<code>class</code>，只有结构<code>struct</code>，结构可以拥有方法。struct 是一种类型，也是成员变量的集合。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style="">
<span class="token comment">// 声明</span>
<span class="token keyword">type</span> Vertex <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    X<span class="token punctuation">,</span> Y <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建</span>
<span class="token keyword">var</span> v <span class="token operator">=</span> Vertex<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> v <span class="token operator">=</span> Vertex<span class="token punctuation">{</span>X<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> Y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>          <span class="token comment">// 带key创建</span>
<span class="token keyword">var</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Vertex<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment">// 初始化struct切片</span>

<span class="token comment">// 访问成员</span>
v<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">4</span>

<span class="token comment">// 在结构上声明方法，结构介于func关键字和方法名称之间。调用时，会复制strut的值。</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>v Vertex<span class="token punctuation">)</span> <span class="token function">Abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">float64</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>X<span class="token operator">*</span>v<span class="token punctuation">.</span>X <span class="token operator">+</span> v<span class="token punctuation">.</span>Y<span class="token operator">*</span>v<span class="token punctuation">.</span>Y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 方法调用</span>
v<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 对于变异方法，需要使用指向struct的指针（见下文）作为类型。调用时，不会复制struct的值。</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>v <span class="token operator">*</span>Vertex<span class="token punctuation">)</span> <span class="token function">add</span><span class="token punctuation">(</span>n <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">.</span>X <span class="token operator">+=</span> n
    v<span class="token punctuation">.</span>Y <span class="token operator">+=</span> n
<span class="token punctuation">}</span>

</code></pre>
<h4><em>匿名 struct:</em>，比<code>map[string]interface{}</code>更轻量和安全</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style="">point <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	X<span class="token punctuation">,</span> Y <span class="token builtin">int</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|669">
                                <div class="section-title"><h3 id="id-291">指针</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style="">p <span class="token operator">:=</span> Vertex<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>  <span class="token comment">// p 是一个 Vertex</span>
q <span class="token operator">:=</span> <span class="token operator">&amp;</span>p            <span class="token comment">// q 是一个指向Vertex的指针</span>
r <span class="token operator">:=</span> <span class="token operator">&amp;</span>Vertex<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">// r 是一个指向Vertex的指针</span>
</code></pre>
<h4>指向 Vertex 的指针类型为 \*Vertex</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> s <span class="token operator">*</span>Vertex <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>Vertex<span class="token punctuation">)</span> <span class="token comment">// 创建一个指向Vertex实例的指针</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|902">
                                <div class="section-title"><h3 id="id-292">类型转换</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> i <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">42</span>
<span class="token keyword">var</span> f <span class="token builtin">float64</span> <span class="token operator">=</span> <span class="token function">float64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">var</span> u <span class="token builtin">uint</span> <span class="token operator">=</span> <span class="token function">uint</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>

<span class="token comment">// alternative syntax</span>
i <span class="token operator">:=</span> <span class="token number">42</span>
f <span class="token operator">:=</span> <span class="token function">float64</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
u <span class="token operator">:=</span> <span class="token function">uint</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-295">Packages</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-294"></h3></div>
                                <div class="section-body">
                                    <ul><li>  每个源文件顶部声明包
</li><li>  可执行文件位于包<code>main</code>中
</li><li>  约定：包名称 == 导入路径最后名称（导入路径<code>math/rand</code> =&gt; 包<code>rand</code>）
</li><li>  大写标识符：<code>exported</code>（在其他包中可见）
</li><li>  小写标识符：<code>private</code>（在其他包中不可见）
</li></ul>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-299">控制结构</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-296">If</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 基本使用</span>
	<span class="token keyword">if</span> x <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> x
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">10</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>x
	<span class="token punctuation">}</span>

	<span class="token comment">// 可以在条件之前加一个声明</span>
	<span class="token keyword">if</span> a <span class="token operator">:=</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span> a <span class="token operator">&lt;</span> <span class="token number">42</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> a
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> a <span class="token operator">-</span> <span class="token number">42</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 在其中使用断言</span>
	<span class="token keyword">var</span> val <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	val <span class="token operator">=</span> <span class="token string">"foo"</span>
	<span class="token keyword">if</span> str<span class="token punctuation">,</span> ok <span class="token operator">:=</span> val<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-297">Loops</h3></div>
                                <div class="section-body">
                                    <p>只有<code>for</code>，没有<code>while</code>和<code>until</code></p>
<pre class="language-go" tabindex="0"><code class="language-go" style="">    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token punctuation">{</span> <span class="token comment">// while - loop</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">{</span> <span class="token comment">// 如果只有条件，可以省略分号</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span> <span class="token comment">// 可以省略条件 ~ while (true)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//在当前循环中使用 break/continue</span>
    <span class="token comment">//在外部循环中使用带标签的 break/continue</span>
here<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> j <span class="token operator">:=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span> here
            <span class="token punctuation">}</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

there<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> j <span class="token operator">:=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span>
            <span class="token punctuation">}</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span> there
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|613">
                                <div class="section-title"><h3 id="id-298">Switch</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">switch</span> operatingSystem <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"darwin"</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Mac OS Hipster"</span><span class="token punctuation">)</span>
        <span class="token comment">// 自动break，默认不会穿透</span>
    <span class="token keyword">case</span> <span class="token string">"linux"</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Linux Geek"</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token comment">// Windows, BSD, ...</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Other"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>与 for 和 if 一样，在 switch 值之前可以有一个赋值语句</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">switch</span> os <span class="token operator">:=</span> runtime<span class="token punctuation">.</span>GOOS<span class="token punctuation">;</span> os <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">"darwin"</span><span class="token punctuation">:</span> <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>可以使用对比</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style="">number <span class="token operator">:=</span> <span class="token number">42</span>
<span class="token keyword">switch</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> number <span class="token operator">&lt;</span> <span class="token number">42</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Smaller"</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> number <span class="token operator">==</span> <span class="token number">42</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Equal"</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> number <span class="token operator">&gt;</span> <span class="token number">42</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Greater"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>多个 case 可用逗号分割</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> char <span class="token builtin">byte</span> <span class="token operator">=</span> <span class="token string">'?'</span>
<span class="token keyword">switch</span> char <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'%'</span><span class="token punctuation">:</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Should escape"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-304">集合</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-300">数组</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token comment">// 声明长度为10的数组，长度是类型的一部分</span>
a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span>     <span class="token comment">// 设置</span>
i <span class="token operator">:=</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>     <span class="token comment">// 读取</span>

<span class="token comment">// 声明并初始化</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span>
a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">// 简写</span>
a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment">// 省略号 -&gt; 编译器计算出数组长度</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-301">切片</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>                      <span class="token comment">// 声明切片 - 和数组类似，但不指定长度</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span>       <span class="token comment">// 声明并初始化切片（由隐式给出的数组支持）</span>
a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">}</span>           <span class="token comment">// 简写</span>
chars <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"b"</span><span class="token punctuation">}</span>  <span class="token comment">// ["a", "b", "c"]</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">:</span>hi<span class="token punctuation">]</span>	<span class="token comment">// 从数组创建切片，区间[lo, hi-1)</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>		<span class="token comment">// 切片索引1到3</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>		<span class="token comment">// 开始索引默认为0</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span>		<span class="token comment">// 结束索引默认len(a)</span>
a <span class="token operator">=</span>  <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>	<span class="token comment">// 切片追加元素，实际对原数组进行对应操作</span>
c <span class="token operator">:=</span> <span class="token function">append</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token operator">...</span><span class="token punctuation">)</span>	<span class="token comment">// 合并切片</span>

<span class="token comment">// 通过 make 创建切片</span>
a <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>	<span class="token comment">// 第一参数为长度，第二个为容量</span>
a <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>	<span class="token comment">// 容量为可选值</span>

<span class="token comment">// 通过数组创建切片</span>
x <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"Лайка"</span><span class="token punctuation">,</span> <span class="token string">"Белка"</span><span class="token punctuation">,</span> <span class="token string">"Стрелка"</span><span class="token punctuation">}</span>
s <span class="token operator">:=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment">// 引用x存储的切片</span>
</code></pre>
<h4>空间的重新分配</h4>
<p>同源切片默认会共享内存，<code>append()</code>这个函数在 <code>cap</code> 不够用的时候就会重新分配内存以扩大容量，而<em>如果够用的时候不不会重新分享内存</em>！</p>
<p><code>append()</code>内存不够会重新分配空间，但其他同源切片(或源数组)后续空间可能会被覆盖，需要 Full Slice Expression：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span>lo<span class="token punctuation">:</span>hi<span class="token punctuation">:</span>li<span class="token punctuation">]</span>
</code></pre>
<p>其最后一个参数叫<em>Limited Capacity</em>，于是，后续的 <code>append()</code> 操作将会导致重新分配内存。</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|293">
                                <div class="section-title"><h3 id="id-302">操作数组和切片</h3></div>
                                <div class="section-body">
                                    <p><code>len(a)</code> 返回数组/切片的长度，这是一个内置函数，而不是数组上的属性/方法。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">// 遍历</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span>
    <span class="token comment">// i 是索引，e是元素</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果只需要e:</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果只需要i:</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在Go 1.4之前的版本中，如果不使用i和e，编译器会报错。</span>
<span class="token comment">// Go 1.4引入了无变量形式，因此可以执行此操作</span>
<span class="token keyword">for</span> <span class="token keyword">range</span> time<span class="token punctuation">.</span><span class="token function">Tick</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do it once a sec</span>
<span class="token punctuation">}</span>

</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|778">
                                <div class="section-title"><h3 id="id-303">Maps</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> m <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span>
m <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>
m<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>m<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"key"</span><span class="token punctuation">)</span>

elem<span class="token punctuation">,</span> ok <span class="token operator">:=</span> m<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token comment">// 测试是否存在键"key"，如果有则返回</span>

<span class="token comment">// map literal</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>Vertex<span class="token punctuation">{</span>
    <span class="token string">"Bell Labs"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token number">40.68433</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">74.39967</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"Google"</span><span class="token punctuation">:</span>    <span class="token punctuation">{</span><span class="token number">37.42202</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">122.08408</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 遍历</span>
<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> m <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-307">多态</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-305">接口</h3></div>
                                <div class="section-body">
                                    <h4>接口声明</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Awesomizer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Awesomize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>类型不声明实现接口</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre>
<h4>如果类型实现所有必需的方法，则它们隐式满足接口</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token punctuation">(</span>foo Foo<span class="token punctuation">)</span> <span class="token function">Awesomize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"Awesome!"</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-306">嵌入</h3></div>
                                <div class="section-body">
                                    <p>Go 中没有<code>子类</code>。 而是有<code>接口</code>和<code>结构</code>嵌入。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">// ReadWriter 实现类必须满足 Reader 和 Writer</span>
<span class="token keyword">type</span> ReadWriter <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    Reader
    Writer
<span class="token punctuation">}</span>

<span class="token comment">// Server 暴露 Logger 的所有方法</span>
<span class="token keyword">type</span> Server <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Host <span class="token builtin">string</span>
    Port <span class="token builtin">int</span>
    <span class="token operator">*</span>log<span class="token punctuation">.</span>Logger
<span class="token punctuation">}</span>

<span class="token comment">// 初始化嵌入类型的常用方式</span>
server <span class="token operator">:=</span> <span class="token operator">&amp;</span>Server<span class="token punctuation">{</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token comment">// 通过嵌入式结构实现的方法</span>
server<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// 调用 server.Logger.Log(...)</span>

<span class="token comment">// 嵌入类型的字段名称是其类型名称（在本例中为Logger）</span>
<span class="token keyword">var</span> logger <span class="token operator">*</span>log<span class="token punctuation">.</span>Logger <span class="token operator">=</span> server<span class="token punctuation">.</span>Logger
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-311">并发</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-308">Goroutines</h3></div>
                                <div class="section-body">
                                    <p><code>Goroutines</code>是轻量级线程（由 Go 而不是 OS 管理）。 <code>go f(a, b)</code>启动一个新的 goroutine，该例程将运行<code>f</code>（<code>f</code>是一个函数）。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">// 只是一个函数（可以稍后作为goroutine启动）</span>
<span class="token keyword">func</span> <span class="token function">doStuff</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在goroutine中使用命名函数</span>
    <span class="token keyword">go</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token string">"foobar"</span><span class="token punctuation">)</span>

    <span class="token comment">// 在goroutine中使用匿名内部函数</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// function body goes here</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-309">Channels</h3></div>
                                <div class="section-body">
                                    <h4>非阻塞通道，发送和接收动作是同时发生的，如果没有接收者，发送会一直阻塞</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style="">ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个类型为int的通道</span>
ch <span class="token operator">&lt;-</span> <span class="token number">42</span>             <span class="token comment">// 将值发送到通道ch</span>
v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch            <span class="token comment">// 接收来自ch的值</span>
</code></pre>
<h4>缓冲通道，如果已写入小于<buffer size="">的未读值，则写入不会阻塞。</buffer></h4>
<pre class="language-go" tabindex="0"><code class="language-go" style="">ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
</code></pre>
<h4>关闭通道（只有发送者应该关闭）</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token function">close</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
</code></pre>
<h4>从通道读取并测试是否已关闭</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style="">v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>ch

<span class="token comment">// 如果ok值为false，通道已被关闭</span>
</code></pre>
<h4>读取通道直至关闭</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> ch <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>尝试多种通道操作，如果没有柱塞，则执行相应操作</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">doStuff</span><span class="token punctuation">(</span>channelOut<span class="token punctuation">,</span> channelIn <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> channelOut <span class="token operator">&lt;-</span> <span class="token number">42</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"We could write to channelOut!"</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> x <span class="token operator">:=</span> <span class="token operator">&lt;-</span> channelIn<span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"We could read from channelIn"</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|467">
                                <div class="section-title"><h3 id="id-310">Channel Axioms</h3></div>
                                <div class="section-body">
                                    <h4>发送到 nil 通道将永远阻塞</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> c <span class="token keyword">chan</span> <span class="token builtin">string</span>
c <span class="token operator">&lt;-</span> <span class="token string">"Hello, World!"</span>
<span class="token comment">// fatal error: all goroutines are asleep - deadlock!</span>
</code></pre>
<h4>接收自 nil 通道将永远阻塞</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> c <span class="token keyword">chan</span> <span class="token builtin">string</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>c<span class="token punctuation">)</span>
<span class="token comment">// fatal error: all goroutines are asleep - deadlock!</span>
</code></pre>
<h4>发送到已关闭通道触发 panic</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
c <span class="token operator">&lt;-</span> <span class="token string">"Hello, World!"</span>
<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
c <span class="token operator">&lt;-</span> <span class="token string">"Hello, Panic!"</span>
<span class="token comment">// panic: send on closed channel</span>
</code></pre>
<h4>来自关闭通道的接收立即返回零值</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
c <span class="token operator">&lt;-</span> <span class="token number">1</span>
c <span class="token operator">&lt;-</span> <span class="token number">2</span>
<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> <span class="token operator">&lt;-</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1 2 0</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-316">杂项</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-312">错误</h3></div>
                                <div class="section-body">
                                    <p>没有异常处理，可能会产生错误的函数只需声明类型为 Error 的附加返回值即可。 这是<code>Error</code>的接口：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> <span class="token builtin">error</span> <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre>
<p>可能返回错误的方法:</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">doStuff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle error</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// all is good, use result</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-313">打印</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style="">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Hello, 你好, नमस्ते, Привет, ᎣᏏᏲ"</span><span class="token punctuation">)</span> <span class="token comment">// 基本打印，结尾换行</span>
p <span class="token operator">:=</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span> X<span class="token punctuation">,</span> Y <span class="token builtin">int</span> <span class="token punctuation">}</span><span class="token punctuation">{</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span> <span class="token string">"My point:"</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token string">"x coord="</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>X <span class="token punctuation">)</span> <span class="token comment">// 打印 structs, ints, 等等</span>
s <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintln</span><span class="token punctuation">(</span> <span class="token string">"My point:"</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token string">"x coord="</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>X <span class="token punctuation">)</span> <span class="token comment">// 打印结果至string变量</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d hex:%x bin:%b fp:%f sci:%e"</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">17.0</span><span class="token punctuation">,</span><span class="token number">17.0</span><span class="token punctuation">)</span> <span class="token comment">// 类c格式化</span>
s2 <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span> <span class="token string">"%d %f"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">17.0</span> <span class="token punctuation">)</span> <span class="token comment">// 打印格式化结果至string变量</span>

hellomsg <span class="token operator">:=</span> <span class="token string">`
 "Hello" in Chinese is 你好 ('Ni Hao')
 "Hello" in Hindi is नमस्ते ('Namaste')
`</span> <span class="token comment">// 多行字符串文字，在开头和结尾使用反引号</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|381">
                                <div class="section-title"><h3 id="id-314">反射 - 类型 Switch</h3></div>
                                <div class="section-body">
                                    <p>类型 switch 类似于常规 switch 语句，但是类型 switch 中的 case 指定类型（不是值），并将这些类型与给定接口的类型进行比较。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">do</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> v <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Twice %v is %v\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token builtin">string</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%q is %v bytes long\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"I don't know about type %T!\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">do</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span>
	<span class="token function">do</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span>
	<span class="token function">do</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|563">
                                <div class="section-title"><h3 id="id-315">HTTP Server</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 定义response类型</span>
<span class="token keyword">type</span> Hello <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 让该类型实现ServeHTTP方法（在接口http.Handler中定义）</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h Hello<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprint</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Hello!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> h Hello
    http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">"localhost:4000"</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// http.ServeHTTP 接口签名:</span>
<span class="token comment">// type Handler interface {</span>
<span class="token comment">//     ServeHTTP(w http.ResponseWriter, r *http.Request)</span>
<span class="token comment">// }</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-322">编程模式</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-317">深度比较</h3></div>
                                <div class="section-body">
                                    <p>比较两个结构体中的数据是否相同时，需要使用深度比较，而不是只是简单地做浅度比较。这里需要使用到反射 <code>reflect.DeepEqual()</code>：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    v1 <span class="token operator">:=</span> data<span class="token punctuation">{</span><span class="token punctuation">}</span>
    v2 <span class="token operator">:=</span> data<span class="token punctuation">{</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"v1 == v2:"</span><span class="token punctuation">,</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//prints: v1 == v2: true</span>

    m1 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"one"</span><span class="token punctuation">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"two"</span><span class="token punctuation">:</span> <span class="token string">"b"</span><span class="token punctuation">}</span>
    m2 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"two"</span><span class="token punctuation">:</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">:</span> <span class="token string">"a"</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"m1 == m2:"</span><span class="token punctuation">,</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//prints: m1 == m2: true</span>

    s1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span>
    s2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"s1 == s2:"</span><span class="token punctuation">,</span>reflect<span class="token punctuation">.</span><span class="token function">DeepEqual</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//prints: s1 == s2: true</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-318">接口编程</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Country <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> City <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Stringable <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c Country<span class="token punctuation">)</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"Country = "</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c City<span class="token punctuation">)</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">"City = "</span> <span class="token operator">+</span> c<span class="token punctuation">.</span>Name
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">PrintStr</span><span class="token punctuation">(</span>p Stringable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

d1 <span class="token operator">:=</span> Country <span class="token punctuation">{</span><span class="token string">"USA"</span><span class="token punctuation">}</span>
d2 <span class="token operator">:=</span> City<span class="token punctuation">{</span><span class="token string">"Los Angeles"</span><span class="token punctuation">}</span>
<span class="token function">PrintStr</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
<span class="token function">PrintStr</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|646">
                                <div class="section-title"><h3 id="id-319">接口完整性检查</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Shape <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Sides</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
    <span class="token function">Area</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Square <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token builtin">len</span> <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s<span class="token operator">*</span> Square<span class="token punctuation">)</span> <span class="token function">Sides</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">4</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s <span class="token operator">:=</span> Square<span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span><span class="token function">Sides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>Square</code> 并没有实现 <code>Shape</code> 接口的所有方法，程序虽然可以跑通，但是这样编程的方式并不严谨。如果我们需要强制实现接口的所有方法，在 Go 语言编程圈里有一个比较标准的作法：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> <span class="token boolean">_</span> Shape <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>Square<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
</code></pre>
<p>声明一个 <code>_</code> 变量（没人用），其会把一个 <code>nil</code> 的空指针，从 <code>Square</code> 转成 <code>Shape</code>，这样，如果没有实现完相关的接口方法，编译器就会报错。</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|653">
                                <div class="section-title"><h3 id="id-320">时间</h3></div>
                                <div class="section-body">
                                    <p>在 Go 语言中，你一定要使用 <code>time.Time</code> 和 <code>time.Duration</code> 两个类型：</p>
<ul><li>  在命令行上，<code>flag</code> 通过 <code>time.ParseDuration</code> 支持了 <code>time.Duration</code>
</li><li>  <code>JSon</code> 中的 <code>encoding/json</code> 中也可以把<code>time.Time</code> 编码成 <a title="RFC 3339" href="https://tools.ietf.org/html/rfc3339" target="_blank">RFC 3339</a> 的格式
</li><li>  数据库使用的 <code>database/sql</code> 也支持把 <code>DATATIME</code> 或 <code>TIMESTAMP</code> 类型转成 <code>time.Time</code>
</li><li>  <code>YAML</code>你可以使用 <code>gopkg.in/yaml.v2</code> 也支持 <code>time.Time</code> 、<code>time.Duration</code> 和 <a title="RFC 3339" href="https://tools.ietf.org/html/rfc3339" target="_blank">RFC 3339</a> 格式
</li></ul>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|890">
                                <div class="section-title"><h3 id="id-321">性能提示</h3></div>
                                <div class="section-body">
                                    <ul><li>  数字转字符串，使用 <code>strconv.Itoa()</code> 会比 <code>fmt.Sprintf()</code> 要快一倍左右
</li><li>  尽可能地避免把<code>String</code>转成<code>[]Byte</code>
</li><li>  如果在<code>for-loop</code>里对某个<code>slice</code> 使用 <code>append()</code>请先把 <code>slice</code>的容量很扩充到位，这样可以避免内存重新分享以及系统自动按 2 的 N 次方幂进行扩展但又用不到，从而浪费内存。
</li><li>  使用<code>StringBuffer</code> 或是<code>StringBuild</code> 来拼接字符串
</li><li>  尽可能的使用并发的 <code>go routine</code>，然后使用 <code>sync.WaitGroup</code> 来同步分片操作
</li><li>  避免在热代码中进行内存分配，这样会导致<code>gc</code>很忙。尽可能的使用 <code>sync.Pool</code> 来重用对象
</li><li>  使用 <code>lock-free</code>的操作，避免使用 <code>mutex</code>，尽可能使用 <code>sync/Atomic</code>包
</li><li>  使用 <code>I/O</code>缓冲，<code>I/O</code>是个非常非常慢的操作，使用 <code>bufio.NewWrite()</code> 和 <code>bufio.NewReader()</code> 可以带来更高的性能
</li><li>  <code>for-loop</code>里的固定的正则表达式，一定要使用 <code>regexp.Compile()</code> 编译正则表达式
</li></ul>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-328">错误处理</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-323"></h3></div>
                                <div class="section-body">
                                    <p>Go 语言的函数支持多返回值，所以，可以在返回接口把业务语义（业务返回值）和控制语义（出错返回值）区分开来。Go 语言的很多函数都会返回 result, err 两个值，于是:</p>
<ul><li>  参数上基本上就是入参，而返回接口把结果和错误分离，这样使得函数的接口语义清晰；
</li><li>  而且，Go 语言中的错误参数如果要忽略，需要显式地忽略，用 <code>_</code> 这样的变量来忽略；
</li><li>  另外，因为返回的 <code>error</code> 是个接口（其中只有一个方法 <code>Error()</code>，返回一个 <code>string</code> ），所以你可以扩展自定义的错误处理。
</li></ul>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-324">多个不同类型的 error：</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> err<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token operator">*</span>json<span class="token punctuation">.</span>SyntaxError<span class="token punctuation">:</span>
      <span class="token operator">...</span>
    <span class="token keyword">case</span> <span class="token operator">*</span>ZeroDivisionError<span class="token punctuation">:</span>
      <span class="token operator">...</span>
    <span class="token keyword">case</span> <span class="token operator">*</span>NullPointerError<span class="token punctuation">:</span>
      <span class="token operator">...</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|240">
                                <div class="section-title"><h3 id="id-325"><code>defer</code> 关键词进行资源清理</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Close</span><span class="token punctuation">(</span>c io<span class="token punctuation">.</span>Closer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"error opening 'a'\n"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">defer</span> <span class="token function">Close</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// 使用defer关键字在函数退出时关闭文件。</span>

  r<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"error opening 'b'\n"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">defer</span> <span class="token function">Close</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// 使用defer关键字在函数退出时关闭文件。</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|373">
                                <div class="section-title"><h3 id="id-326">优雅的错误检查</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Reader <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    r   io<span class="token punctuation">.</span>Reader
    err <span class="token builtin">error</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>Reader<span class="token punctuation">)</span> <span class="token function">read</span><span class="token punctuation">(</span>data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> r<span class="token punctuation">.</span>err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span>err <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>r<span class="token punctuation">,</span> binary<span class="token punctuation">.</span>BigEndian<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">parse</span><span class="token punctuation">(</span>input io<span class="token punctuation">.</span>Reader<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Point<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> p Point
    r <span class="token operator">:=</span> Reader<span class="token punctuation">{</span>r<span class="token punctuation">:</span> input<span class="token punctuation">}</span>

    r<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>Longitude<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>Latitude<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>Distance<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>ElevationGain<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>ElevationLoss<span class="token punctuation">)</span>

    <span class="token keyword">if</span> r<span class="token punctuation">.</span>err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>err
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>流式接口 Fluent Interface</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"bytes"</span>
  <span class="token string">"encoding/binary"</span>
  <span class="token string">"fmt"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 长度不够，少一个Weight</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span><span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6f</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6e</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> r <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
  Age <span class="token builtin">uint8</span>
  Weight <span class="token builtin">uint8</span>
  err <span class="token builtin">error</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">read</span><span class="token punctuation">(</span>data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> p<span class="token punctuation">.</span>err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    p<span class="token punctuation">.</span>err <span class="token operator">=</span> binary<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> binary<span class="token punctuation">.</span>BigEndian<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">ReadName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">ReadAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">ReadWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">.</span>Weight<span class="token punctuation">)</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Person<span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Person <span class="token punctuation">{</span>
  <span class="token keyword">if</span> p<span class="token punctuation">.</span>err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Name=%s, Age=%d, Weight=%d\n"</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Weight<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> p
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  p <span class="token operator">:=</span> Person<span class="token punctuation">{</span><span class="token punctuation">}</span>
  p<span class="token punctuation">.</span><span class="token function">ReadName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>err<span class="token punctuation">)</span>  <span class="token comment">// EOF 错误</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|731">
                                <div class="section-title"><h3 id="id-327">包装错误</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"something failed: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> authorizationError <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    operation <span class="token builtin">string</span>
    err <span class="token builtin">error</span>   <span class="token comment">// original error</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>authorizationError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"authorization failed during %s: %v"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>operation<span class="token punctuation">,</span> e<span class="token punctuation">.</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h4>使用 causer 接口中实现 Cause() 方法来暴露原始错误</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> causer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>authorizationError<span class="token punctuation">)</span> <span class="token function">Cause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> e<span class="token punctuation">.</span>err
<span class="token punctuation">}</span>
</code></pre>
<h4>第三方的错误库（github.com/pkg/errors）</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">import</span> <span class="token string">"github.com/pkg/errors"</span>

<span class="token comment">//错误包装</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"read failed"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Cause接口</span>
<span class="token keyword">switch</span> err <span class="token operator">:=</span> errors<span class="token punctuation">.</span><span class="token function">Cause</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token operator">*</span>MyError<span class="token punctuation">:</span>
    <span class="token comment">// handle specifically</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token comment">// unknown error</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-332">函数式编程</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-329"></h3></div>
                                <div class="section-body">
                                    <p>Go 语言不支持重载函数，所以，需要使用不同的函数名来应对不同入参需求</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-330">Builder 模式</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">//使用一个builder类来做包装</span>
<span class="token keyword">type</span> ServerBuilder <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Server
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sb <span class="token operator">*</span>ServerBuilder<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>addr <span class="token builtin">string</span><span class="token punctuation">,</span> port <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>ServerBuilder <span class="token punctuation">{</span>
  sb<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Addr <span class="token operator">=</span> addr
  sb<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Port <span class="token operator">=</span> port
  <span class="token comment">//其它代码设置其它成员的默认值</span>
  <span class="token keyword">return</span> sb
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sb <span class="token operator">*</span>ServerBuilder<span class="token punctuation">)</span> <span class="token function">WithProtocol</span><span class="token punctuation">(</span>protocol <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>ServerBuilder <span class="token punctuation">{</span>
  sb<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Protocol <span class="token operator">=</span> protocol
  <span class="token keyword">return</span> sb
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>sb <span class="token operator">*</span>ServerBuilder<span class="token punctuation">)</span> <span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>  sb<span class="token punctuation">.</span>Server
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style="">sb <span class="token operator">:=</span> ServerBuilder<span class="token punctuation">{</span><span class="token punctuation">}</span>
server<span class="token punctuation">,</span> err <span class="token operator">:=</span> sb<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">WithProtocol</span><span class="token punctuation">(</span><span class="token string">"udp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|116">
                                <div class="section-title"><h3 id="id-331">Functional Options</h3></div>
                                <div class="section-body">
                                    <p>先定义一个函数类型：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Option <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>Server<span class="token punctuation">)</span>
</code></pre>
<p>使用函数式的方式定义一组如下的函数：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Protocol</span><span class="token punctuation">(</span>p <span class="token builtin">string</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>Protocol <span class="token operator">=</span> p
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">Timeout</span><span class="token punctuation">(</span>timeout time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>Timeout <span class="token operator">=</span> timeout
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">MaxConns</span><span class="token punctuation">(</span>maxconns <span class="token builtin">int</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>MaxConns <span class="token operator">=</span> maxconns
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">TLS</span><span class="token punctuation">(</span>tls <span class="token operator">*</span>tls<span class="token punctuation">.</span>Config<span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>TLS <span class="token operator">=</span> tls
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  当我们调用其中的一个函数用 <code>MaxConns(30)</code> 时
</li><li>  其返回值是一个 <code>func(s* Server) { s.MaxConns = 30 }</code> 的函数。
</li></ul>
<p>使用：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">NewServer</span><span class="token punctuation">(</span>addr <span class="token builtin">string</span><span class="token punctuation">,</span> port <span class="token builtin">int</span><span class="token punctuation">,</span> options <span class="token operator">...</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>Server<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Server<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  srv <span class="token operator">:=</span> Server<span class="token punctuation">{</span>
    Addr<span class="token punctuation">:</span>     addr<span class="token punctuation">,</span>
    Port<span class="token punctuation">:</span>     port<span class="token punctuation">,</span>
    Protocol<span class="token punctuation">:</span> <span class="token string">"tcp"</span><span class="token punctuation">,</span>
    Timeout<span class="token punctuation">:</span>  <span class="token number">30</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
    MaxConns<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    TLS<span class="token punctuation">:</span>      <span class="token boolean">nil</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> option <span class="token operator">:=</span> <span class="token keyword">range</span> options <span class="token punctuation">{</span>
    <span class="token function">option</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>srv<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//...</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>srv<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style="">s1<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
s2<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">,</span> <span class="token function">Protocol</span><span class="token punctuation">(</span><span class="token string">"udp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
s3<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">NewServer</span><span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">,</span> <span class="token function">Timeout</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">MaxConns</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-335">委托和反转控制</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-333">委托</h3></div>
                                <div class="section-body">
                                    <p>Go 语言可以把一个结构体嵌入另一个结构体</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Widget <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    X<span class="token punctuation">,</span> Y <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> Label <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Widget        <span class="token comment">// Embedding (delegation)</span>
    Text   <span class="token builtin">string</span> <span class="token comment">// Aggregation</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
label <span class="token operator">:=</span> Label<span class="token punctuation">{</span>Widget<span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"State:"</span><span class="token punctuation">}</span>
label<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">11</span>
label<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token number">12</span>
</code></pre>
<p>如果在 <code>Label</code> 结构体里出现了重名，就需要解决重名，例如，如果 成员 <code>X</code> 重名，用 <code>label.X</code>表明 是自己的<code>X</code> ，用 <code>label.Wedget.X</code> 表示嵌入过来的。</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-334">翻转控制</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Undo <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token punctuation">(</span>undo <span class="token operator">*</span>Undo<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>function <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">*</span>undo <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token operator">*</span>undo<span class="token punctuation">,</span> function<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>undo <span class="token operator">*</span>Undo<span class="token punctuation">)</span> <span class="token function">Undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  functions <span class="token operator">:=</span> <span class="token operator">*</span>undo
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>functions<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"No functions to undo"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  index <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>functions<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">if</span> function <span class="token operator">:=</span> functions<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> function <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    functions<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">nil</span> <span class="token comment">// For garbage collection</span>
  <span class="token punctuation">}</span>
  <span class="token operator">*</span>undo <span class="token operator">=</span> functions<span class="token punctuation">[</span><span class="token punctuation">:</span>index<span class="token punctuation">]</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> IntSet <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    data <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">bool</span>
    undo Undo
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewIntSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> IntSet <span class="token punctuation">{</span>
    <span class="token keyword">return</span> IntSet<span class="token punctuation">{</span>data<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>set <span class="token operator">*</span>IntSet<span class="token punctuation">)</span> <span class="token function">Undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> set<span class="token punctuation">.</span>undo<span class="token punctuation">.</span><span class="token function">Undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>set <span class="token operator">*</span>IntSet<span class="token punctuation">)</span> <span class="token function">Contains</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> set<span class="token punctuation">.</span>data<span class="token punctuation">[</span>x<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>set <span class="token operator">*</span>IntSet<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        set<span class="token punctuation">.</span>data<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
        set<span class="token punctuation">.</span>undo<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> set<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        set<span class="token punctuation">.</span>undo<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>set <span class="token operator">*</span>IntSet<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>x <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> set<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delete</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span>data<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
        set<span class="token punctuation">.</span>undo<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> set<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        set<span class="token punctuation">.</span>undo<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>不再由 控制逻辑 <code>Undo</code> 来依赖业务逻辑 <code>IntSet</code>，而是由业务逻辑 <code>IntSet</code> 来依赖 <code>Undo</code> 。其依赖的是其实是一个协议，这个协议是一个没有参数的函数数组。我们也可以看到，我们 <code>Undo</code> 的代码就可以复用了。</p>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-344">MAP-REDUCE</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-336">Map</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">MapStrToStr</span><span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> it <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
        newArray <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>newArray<span class="token punctuation">,</span> <span class="token function">fn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newArray
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">MapStrToInt</span><span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> it <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
        newArray <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>newArray<span class="token punctuation">,</span> <span class="token function">fn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newArray
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"Hao"</span><span class="token punctuation">,</span> <span class="token string">"Chen"</span><span class="token punctuation">,</span> <span class="token string">"MegaEase"</span><span class="token punctuation">}</span>

x <span class="token operator">:=</span> <span class="token function">MapStrToStr</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
<span class="token comment">//["HAO", "CHEN", "MEGAEASE"]</span>

y <span class="token operator">:=</span> <span class="token function">MapStrToInt</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token comment">//[3, 4, 8]</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-337">Reduce</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Reduce</span><span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    sum <span class="token operator">:=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> it <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> <span class="token function">fn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sum
<span class="token punctuation">}</span>

<span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"Hao"</span><span class="token punctuation">,</span> <span class="token string">"Chen"</span><span class="token punctuation">,</span> <span class="token string">"MegaEase"</span><span class="token punctuation">}</span>

x <span class="token operator">:=</span> <span class="token function">Reduce</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
<span class="token comment">// 15</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|433">
                                <div class="section-title"><h3 id="id-338">Filter</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Filter</span><span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> fn <span class="token keyword">func</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> newArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> it <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token function">fn</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newArray <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>newArray<span class="token punctuation">,</span> it<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newArray
<span class="token punctuation">}</span>

<span class="token keyword">var</span> intset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span>
out <span class="token operator">:=</span> <span class="token function">Filter</span><span class="token punctuation">(</span>intset<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> n<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span>

out <span class="token operator">=</span> <span class="token function">Filter</span><span class="token punctuation">(</span>intset<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n <span class="token operator">&gt;</span> <span class="token number">5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v\n"</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|700">
                                <div class="section-title"><h3 id="id-339">Map-Reduce 与 泛型</h3></div>
                                <div class="section-body">
                                    <p><code>Map/Reduce/Filter</code>只是一种控制逻辑，真正的业务逻辑是在传给他们的数据和那个函数来定义的。是的，这是一个很经典的<em>业务逻辑</em>和<em>控制逻辑</em>分离解耦的编程模式。</p>
<pre class="language- language-none" tabindex="0"><code class="language- language-none" style="">Go开发团队技术负责人Russ Cox在2012年11月21golang-dev上的mail确认了Go泛型(type parameter)将在Go 1.18版本落地，即2022.2月份
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|892">
                                <div class="section-title"><h3 id="id-340">简单版 Generic Map</h3></div>
                                <div class="section-body">
                                    <p>目前的<code>Go</code>语言的泛型只能用 <code>interface{} + reflect</code>来完成，<code>interface{}</code> 可以理解为<code>C</code>中的 <code>void*</code>，<code>Java</code>中的 <code>Object</code> ，<code>reflect</code>是<code>Go</code>的反射机制包，用于在运行时检查类型。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Map</span><span class="token punctuation">(</span>data <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fn <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
    vfn <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
    vdata <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> vdata<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vdata<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> vfn<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">{</span>vdata<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  通过 reflect.ValueOf() 来获得 interface{} 的值，其中一个是数据 vdata，另一个是函数 vfn，
</li><li>  然后通过 vfn.Call() 方法来调用函数，通过 []refelct.Value{vdata.Index(i)}来获得数据。
</li></ul>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|924">
                                <div class="section-title"><h3 id="id-341">健壮版的 Generic Map</h3></div>
                                <div class="section-body">
                                    <p>要写一个健壮的程序，对于这种用<code>interface{}</code> 的“过度泛型”，就需要我们自己来做类型检查。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Transform</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">transform</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">TransformInPlace</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">transform</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">transform</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inPlace <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>

  <span class="token comment">//check the &lt;code data-enlighter-language="raw" class="EnlighterJSRAW"&gt;slice&lt;/code&gt; type is Slice</span>
  sliceInType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span>
  <span class="token keyword">if</span> sliceInType<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Slice <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"transform: not slice"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//check the function signature</span>
  fn <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span>
  elemType <span class="token operator">:=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">verifyFuncSignature</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> elemType<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"trasform: function must be of type func("</span> <span class="token operator">+</span> sliceInType<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">") outputElemType"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  sliceOutType <span class="token operator">:=</span> sliceInType
  <span class="token keyword">if</span> <span class="token operator">!</span>inPlace <span class="token punctuation">{</span>
    sliceOutType <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">MakeSlice</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">SliceOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Out</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sliceInType<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sliceInType<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sliceInType<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    sliceOutType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">{</span>sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sliceOutType<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">verifyFuncSignature</span><span class="token punctuation">(</span>fn reflect<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> types <span class="token operator">...</span>reflect<span class="token punctuation">.</span>Type<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>

  <span class="token comment">//Check it is a funciton</span>
  <span class="token keyword">if</span> fn<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Func <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// NumIn() - returns a function type's input parameter count.</span>
  <span class="token comment">// NumOut() - returns a function type's output parameter count.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NumIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>types<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NumOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// In() - returns the type of a function type's i'th input parameter.</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>types<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> fn<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">In</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">!=</span> types<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Out() - returns the type of a function type's i'th output parameter.</span>
  outType <span class="token operator">:=</span> types<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>types<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> outType <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Out</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> outType <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  代码中没有使用<code>Map</code>函数，因为和数据结构和关键有含义冲突的问题，所以使用<code>Transform</code>，这个来源于 <code>C++ STL</code>库中的命名。
</li><li>  有两个版本的函数，一个是返回一个全新的数组 – <code>Transform()</code>，一个是“就地完成” – <code>TransformInPlace()</code>
</li><li>  在主函数中，用 <code>Kind()</code> 方法检查了数据类型是不是 <code>Slice</code>，函数类型是不是<code>Func</code>
</li><li>  检查函数的参数和返回类型是通过 <code>verifyFuncSignature()</code> 来完成的，其中：
</li><li>  <code>NumIn()</code> – 用来检查函数的“入参”
</li><li>  <code>NumOut()</code> 用来检查函数的“返回值”
</li><li>  如果需要新生成一个<code>Slice</code>，会使用 <code>reflect.MakeSlice()</code> 来完成。
</li></ul>
<pre class="language-go" tabindex="0"><code class="language-go" style="">list <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"6"</span><span class="token punctuation">}</span>
result <span class="token operator">:=</span> <span class="token function">Transform</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span>a <span class="token operator">+</span>a
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//{"111","222","333","444","555","666"}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|1351">
                                <div class="section-title"><h3 id="id-342">健壮版的 Generic Reduce</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Reduce</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> pairFunc<span class="token punctuation">,</span> zero <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
  sliceInType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span>
  <span class="token keyword">if</span> sliceInType<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Slice <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"reduce: wrong type, not slice"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">len</span> <span class="token operator">:=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token builtin">len</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> zero
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token builtin">len</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  elemType <span class="token operator">:=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  fn <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>pairFunc<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">verifyFuncSignature</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> elemType<span class="token punctuation">,</span> elemType<span class="token punctuation">,</span> elemType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t <span class="token operator">:=</span> elemType<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"reduce: function must be of type func("</span> <span class="token operator">+</span> t <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> t <span class="token operator">+</span> <span class="token string">") "</span> <span class="token operator">+</span> t<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> ins <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value
  ins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  ins<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  out <span class="token operator">:=</span> fn<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>ins<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    ins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> out
    ins<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    out <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>ins<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|2090">
                                <div class="section-title"><h3 id="id-343">健壮版的 Generic Filter</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Filter</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
  result<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">filter</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">FilterInPlace</span><span class="token punctuation">(</span>slicePtr<span class="token punctuation">,</span> function <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  in <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>slicePtr<span class="token punctuation">)</span>
  <span class="token keyword">if</span> in<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Ptr <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"FilterInPlace: wrong type, "</span> <span class="token operator">+</span>
      <span class="token string">"not a pointer to slice"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token boolean">_</span><span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token function">filter</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  in<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetLen</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> boolType <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">filter</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> function <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> inPlace <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  sliceInType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span>
  <span class="token keyword">if</span> sliceInType<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Slice <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"filter: wrong type, not a slice"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  fn <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>function<span class="token punctuation">)</span>
  elemType <span class="token operator">:=</span> sliceInType<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">verifyFuncSignature</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> elemType<span class="token punctuation">,</span> boolType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"filter: function must be of type func("</span> <span class="token operator">+</span> elemType<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">") bool"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> which <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sliceInType<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> fn<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">{</span>sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Bool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      which <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>which<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  out <span class="token operator">:=</span> sliceInType

  <span class="token keyword">if</span> <span class="token operator">!</span>inPlace <span class="token punctuation">{</span>
    out <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">MakeSlice</span><span class="token punctuation">(</span>sliceInType<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>which<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>which<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> which <span class="token punctuation">{</span>
    out<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>sliceInType<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>which<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> out<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>which<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-349">GO GENERATION</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-345">类型检查</h3></div>
                                <div class="section-body">
                                    <p>因为<code>Go</code>语言目前并不支持真正的泛型，所以，只能用 <code>interface{}</code> 这样的类似于 <code>void*</code> 这种过度泛型来玩这就导致了我们在实际过程中就需要进行类型检查。<code>Go</code>语言的类型检查有两种技术，一种是 <code>Type Assert</code>，一种是<code>Reflection</code>。</p>
<h4>Type Assert</h4>
<p>对某个变量进行 <code>.(type)</code>的转型操作，其会返回两个值， <code>variable, error</code>，第一个返回值是被转换好的类型，第二个是如果不能转换类型，则会报错。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">//Container is a generic container, accepting anything.</span>
<span class="token keyword">type</span> Container <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//Put adds an element to the container.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>elem <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token operator">*</span>c<span class="token punctuation">,</span> elem<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//Get gets an element from the container.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
    elem <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> elem
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style="">intContainer <span class="token operator">:=</span> <span class="token operator">&amp;</span>Container<span class="token punctuation">{</span><span class="token punctuation">}</span>
intContainer<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
intContainer<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
</code></pre>
<p>但是，在把数据取出来时，因为类型是 <code>interface{}</code> ，所以，你还要做一个转型，如果转型成功能才能进行后续操作</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">// assert that the actual type is int</span>
elem<span class="token punctuation">,</span> ok <span class="token operator">:=</span> intContainer<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Unable to read an int from intContainer"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"assertExample: %d (%T)\n"</span><span class="token punctuation">,</span> elem<span class="token punctuation">,</span> elem<span class="token punctuation">)</span>
</code></pre>
<h4>Reflection</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Container <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    s reflect<span class="token punctuation">.</span>Value
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">NewContainer</span><span class="token punctuation">(</span>t reflect<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Container <span class="token punctuation">{</span>
    <span class="token keyword">if</span> size <span class="token operator">&lt;=</span><span class="token number">0</span>  <span class="token punctuation">{</span> size<span class="token operator">=</span><span class="token number">64</span> <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Container<span class="token punctuation">{</span>
        s<span class="token punctuation">:</span> reflect<span class="token punctuation">.</span><span class="token function">MakeSlice</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">SliceOf</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>val <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Put: cannot put a %T into a slice of %s"</span><span class="token punctuation">,</span>
            val<span class="token punctuation">,</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    c<span class="token punctuation">.</span>s <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>s<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Container<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>refval <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>refval<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Ptr <span class="token operator">||</span>
        reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>refval<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Get: needs *%s but got %T"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> refval<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>refval<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    c<span class="token punctuation">.</span>s <span class="token operator">=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  在 <code>NewContainer()</code>会根据参数的类型初始化一个<code>Slice</code>
</li><li>  在 <code>Put()</code>时候，会检查 <code>val</code> 是否和<code>Slice</code>的类型一致。
</li><li>  在 <code>Get()</code>时，我们需要用一个入参的方式，因为我们没有办法返回 <code>reflect.Value</code> 或是 <code>interface{}</code>，不然还要做<code>Type Assert</code>
</li><li>  但是有类型检查，所以，必然会有检查不对的道理 ，因此，需要返回 <code>error</code>
</li></ul>
<pre class="language-go" tabindex="0"><code class="language-go" style="">f1 <span class="token operator">:=</span> <span class="token number">3.1415926</span>
f2 <span class="token operator">:=</span> <span class="token number">1.41421356237</span>

c <span class="token operator">:=</span> <span class="token function">NewMyContainer</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

g <span class="token operator">:=</span> <span class="token number">0.0</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%v (%T)\n"</span><span class="token punctuation">,</span> g<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token comment">//3.1415926 (float64)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//1.4142135623</span>
</code></pre>
<p><code>Type Assert</code>是不用了，但是用反射写出来的代码还是有点复杂的。</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-346">Go Generator</h3></div>
                                <div class="section-body">
                                    <h4>C++ Template</h4>
<p>对于泛型编程最牛的语言 <code>C++</code> 来说，这类的问题都是使用 <code>Template</code>来解决的。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">//用&lt;class T&gt;来描述泛型</span>
template <span class="token operator">&lt;</span>class T<span class="token operator">&gt;</span>
T GetMax <span class="token punctuation">(</span>T a<span class="token punctuation">,</span> T b<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
    T result<span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">&gt;</span>b<span class="token punctuation">)</span>? a <span class="token punctuation">:</span> b<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token builtin">int</span> i<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> j<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> k<span class="token punctuation">;</span>
<span class="token comment">//生成int类型的函数</span>
k<span class="token operator">=</span>GetMax<span class="token operator">&lt;</span><span class="token builtin">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>

long l<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> n<span class="token punctuation">;</span>
<span class="token comment">//生成long类型的函数</span>
n<span class="token operator">=</span>GetMax<span class="token operator">&lt;</span>long<span class="token operator">&gt;</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>C++</code>的编译器会在编译时分析代码，根据不同的变量类型来自动化的生成相关类型的函数或类。<code>C++</code>叫模板的具体化。</p>
<p>这个技术是编译时的问题，所以，不需要我们在运行时进行任何的运行的类型识别，我们的程序也会变得比较的干净。Go 的编译器不帮你干，你需要自己动手。</p>
<p>要玩 Go 的代码生成，你需要三件事：</p>
<ul><li>  一个函数模板，其中设置好相应的占位符。
</li><li>  一个脚本，用于按规则来替换文本并生成新的代码。
</li><li>  一行注释代码。
</li></ul>
<h4>函数模板</h4>
<p>我们把我们之前的示例改成模板。取名为 <code>container.tmp.go</code> 放在 <code>./template/</code>下</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> PACKAGE_NAME
<span class="token keyword">type</span> GENERIC_NAMEContainer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    s <span class="token punctuation">[</span><span class="token punctuation">]</span>GENERIC_TYPE
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">NewGENERIC_NAMEContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>GENERIC_NAMEContainer <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>GENERIC_NAMEContainer<span class="token punctuation">{</span>s<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>GENERIC_TYPE<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>GENERIC_NAMEContainer<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>val GENERIC_TYPE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>s<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>GENERIC_NAMEContainer<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> GENERIC_TYPE <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    c<span class="token punctuation">.</span>s <span class="token operator">=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> r
<span class="token punctuation">}</span>
</code></pre>
<p>我们可以看到函数模板中我们有如下的占位符：</p>
<ul><li>  <code>PACKAGE_NAME</code> – 包名
</li><li>  <code>GENERIC_NAME</code> – 名字
</li><li>  <code>GENERIC_TYPE</code> – 实际的类型
</li></ul>
<h4>函数生成脚本</h4>
<p>然后，我们有一个叫<code>gen.sh</code>的生成脚本，如下所示：</p>
<pre class="language-shell" tabindex="0"><code class="language-shell" style=""><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">set</span> -e

<span class="token assign-left variable">SRC_FILE</span><span class="token operator">=</span><span class="token variable">${1}</span>
<span class="token assign-left variable">PACKAGE</span><span class="token operator">=</span><span class="token variable">${2}</span>
<span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token variable">${3}</span>
<span class="token assign-left variable">DES</span><span class="token operator">=</span><span class="token variable">${4}</span>
<span class="token comment">#uppcase the first char</span>
<span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">tr</span> <span class="token string">'[:lower:]'</span> <span class="token string">'[:upper:]'</span> <span class="token operator">&lt;&lt;&lt;</span> $<span class="token punctuation">{</span>TYPE:0:1<span class="token punctuation">}</span><span class="token variable">)</span></span><span class="token variable">${TYPE<span class="token operator">:</span>1}</span>"</span>

<span class="token assign-left variable">DES_FILE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> $<span class="token punctuation">{</span>TYPE<span class="token punctuation">}</span><span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'[:upper:]'</span> <span class="token string">'[:lower:]'</span><span class="token variable">)</span></span>_<span class="token variable">${DES}</span>.go

<span class="token function">sed</span> <span class="token string">'s/PACKAGE_NAME/'</span><span class="token string">"<span class="token variable">${PACKAGE}</span>"</span>'/g<span class="token string">' ${SRC_FILE} | \
    sed '</span>s/GENERIC_TYPE/<span class="token string">'"${TYPE}"'</span>/g<span class="token string">' | \
    sed '</span>s/GENERIC_NAME/<span class="token string">'"${PREFIX}"'</span>/g' <span class="token operator">&gt;</span> <span class="token variable">${DES_FILE}</span>
</code></pre>
<p>其需要 4 个参数：</p>
<ul><li>  模板源文件
</li><li>  包名
</li><li>  实际需要具体化的类型
</li><li>  用于构造目标文件名的后缀
</li></ul>
<h4>生成代码</h4>
<p>接下来，我们只需要在代码中打一个特殊的注释：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token comment">//go:generate ./gen.sh ./template/container.tmp.go gen uint32 container</span>
<span class="token keyword">func</span> <span class="token function">generateUint32Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> u <span class="token builtin">uint32</span> <span class="token operator">=</span> <span class="token number">42</span>
    c <span class="token operator">:=</span> <span class="token function">NewUint32Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
    v <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"generateExample: %d (%T)\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//go:generate ./gen.sh ./template/container.tmp.go gen string container</span>
<span class="token keyword">func</span> <span class="token function">generateStringExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> s <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"Hello"</span>
    c <span class="token operator">:=</span> <span class="token function">NewStringContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    v <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"generateExample: %s (%T)\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  第一个注释是生成包名为 <code>gen</code> 类型为 <code>uint32</code> 目标文件名以 <code>container</code> 为后缀
</li><li>  第二个注释是生成包名为 <code>gen</code> 类型为 <code>string</code> 目标文件名以 <code>container</code> 为后缀
</li></ul>
<p>然后，在工程目录中直接执行 <code>go generate</code> 命令，就会生成两份代码。</p>
<p>一份文件名为<code>uint32_container.go</code>:</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> gen

<span class="token keyword">type</span> Uint32Container <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint32</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">NewUint32Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Uint32Container <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>Uint32Container<span class="token punctuation">{</span>s<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">uint32</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Uint32Container<span class="token punctuation">)</span> <span class="token function">Put</span><span class="token punctuation">(</span>val <span class="token builtin">uint32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>s<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Uint32Container<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">uint32</span> <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    c<span class="token punctuation">.</span>s <span class="token operator">=</span> c<span class="token punctuation">.</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> r
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|2099">
                                <div class="section-title"><h3 id="id-347">新版 Filter</h3></div>
                                <div class="section-body">
                                    <p><code>Fitler</code>的模板文件 <code>filter.tmp.go</code></p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> PACKAGE_NAME

<span class="token keyword">type</span> GENERIC_NAMEList <span class="token punctuation">[</span><span class="token punctuation">]</span>GENERIC_TYPE

<span class="token keyword">type</span> GENERIC_NAMEToBool <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token operator">*</span>GENERIC_TYPE<span class="token punctuation">)</span> <span class="token builtin">bool</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>al GENERIC_NAMEList<span class="token punctuation">)</span> <span class="token function">Filter</span><span class="token punctuation">(</span>f GENERIC_NAMEToBool<span class="token punctuation">)</span> GENERIC_NAMEList <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ret GENERIC_NAMEList
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> al <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ret <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>
</code></pre>
<p>于是我们可在需要使用这个的地方，加上相关的 <code>go generate</code> 的注释</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> Employee <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name     <span class="token builtin">string</span>
  Age      <span class="token builtin">int</span>
  Vacation <span class="token builtin">int</span>
  Salary   <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">//go:generate ./gen.sh ./template/filter.tmp.go gen Employee filter</span>
<span class="token keyword">func</span> <span class="token function">filterEmployeeExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">var</span> list <span class="token operator">=</span> EmployeeList<span class="token punctuation">{</span>
    <span class="token punctuation">{</span><span class="token string">"Hao"</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7500</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> filter EmployeeList
  filter <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>Employee<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> e<span class="token punctuation">.</span>Age <span class="token operator">&gt;</span> <span class="token number">40</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"----- Employee.Age &gt; 40 ------"</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> filter <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  filter <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>e <span class="token operator">*</span>Employee<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> e<span class="token punctuation">.</span>Salary <span class="token operator">&lt;=</span> <span class="token number">5000</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"----- Employee.Salary &lt;= 5000 ------"</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> filter <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|2869">
                                <div class="section-title"><h3 id="id-348">第三方工具</h3></div>
                                <div class="section-body">
                                    <p>我们并不需要自己手写 <code>gen.sh</code> 这样的工具类，已经有很多第三方的已经写好的可以使用。下面是一个列表：</p>
<ul><li>  Genny – <a title="https://github.com/cheekybits/genny" href="https://github.com/cheekybits/genny" target="_blank">https://github.com/cheekybits/genny</a>
</li><li>  Generic – <a title="https://github.com/taylorchu/generic" href="https://github.com/taylorchu/generic" target="_blank">https://github.com/taylorchu/generic</a>
</li><li>  GenGen – <a title="https://github.com/joeshaw/gengen" href="https://github.com/taylorchu/generic" target="_blank">https://github.com/joeshaw/gengen</a>
</li><li>  Gen – <a title="https://github.com/clipperhouse/gen" href="https://github.com/clipperhouse/gen" target="_blank">https://github.com/clipperhouse/gen</a>
</li></ul>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-354">修饰器</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-350">简单示例</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">decorator</span><span class="token punctuation">(</span>f <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Started"</span><span class="token punctuation">)</span>
        <span class="token function">f</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Done"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Hello</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">decorator</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>如果你要想让代码容易读一些，你可以这样：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style="">hello <span class="token operator">:=</span> <span class="token function">decorator</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span>
</code></pre>
<p>我们再来看一个和计算运行时间的例子：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"fmt"</span>
  <span class="token string">"reflect"</span>
  <span class="token string">"runtime"</span>
  <span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> SumFunc <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">int64</span>

<span class="token keyword">func</span> <span class="token function">getFunctionName</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> runtime<span class="token punctuation">.</span><span class="token function">FuncForPC</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">timedSumFunc</span><span class="token punctuation">(</span>f SumFunc<span class="token punctuation">)</span> SumFunc <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span>

    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"--- Time Elapsed (%s): %v ---\n"</span><span class="token punctuation">,</span>
          <span class="token function">getFunctionName</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Sum1</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> sum <span class="token builtin">int64</span>
  sum <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">if</span> start <span class="token operator">&gt;</span> end <span class="token punctuation">{</span>
    start<span class="token punctuation">,</span> end <span class="token operator">=</span> end<span class="token punctuation">,</span> start
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> i
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> sum
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Sum2</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">int64</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> start <span class="token operator">&gt;</span> end <span class="token punctuation">{</span>
    start<span class="token punctuation">,</span> end <span class="token operator">=</span> end<span class="token punctuation">,</span> start
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>end <span class="token operator">+</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  sum1 <span class="token operator">:=</span> <span class="token function">timedSumFunc</span><span class="token punctuation">(</span>Sum1<span class="token punctuation">)</span>
  sum2 <span class="token operator">:=</span> <span class="token function">timedSumFunc</span><span class="token punctuation">(</span>Sum2<span class="token punctuation">)</span>

  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d, %d\n"</span><span class="token punctuation">,</span> <span class="token function">sum1</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sum2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  <code>1</code>）有两个 <code>Sum</code> 函数，<code>Sum1()</code> 函数就是简单的做个循环，<code>Sum2()</code> 函数动用了数据公式。（注意：<code>start</code> 和 <code>end</code> 有可能有负数的情况）
</li><li>  <code>2</code>）代码中使用了 <code>Go</code> 语言的反射机器来获取函数名。
</li><li>  <code>3</code>）修饰器函数是 <code>timedSumFunc()</code>
</li></ul>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-351">HTTP 相关的一个示例</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"log"</span>
    <span class="token string">"net/http"</span>
    <span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">WithServerHeader</span><span class="token punctuation">(</span>h http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"---&gt;WithServerHeader()"</span><span class="token punctuation">)</span>
        w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Server"</span><span class="token punctuation">,</span> <span class="token string">"HelloServer v0.0.1"</span><span class="token punctuation">)</span>
        <span class="token function">h</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">hello</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Recieved Request %s from %s\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Hello, World! "</span><span class="token operator">+</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/v1/hello"</span><span class="token punctuation">,</span> <span class="token function">WithServerHeader</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">)</span>
    err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"ListenAndServe: "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>于是，这样的函数我们可以写出好些个。如下所示，有写 HTTP 响应头的，有写认证 Cookie 的，有检查认证 Cookie 的，有打日志的……</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"log"</span>
    <span class="token string">"net/http"</span>
    <span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">WithServerHeader</span><span class="token punctuation">(</span>h http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"---&gt;WithServerHeader()"</span><span class="token punctuation">)</span>
        w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Server"</span><span class="token punctuation">,</span> <span class="token string">"HelloServer v0.0.1"</span><span class="token punctuation">)</span>
        <span class="token function">h</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithAuthCookie</span><span class="token punctuation">(</span>h http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"---&gt;WithAuthCookie()"</span><span class="token punctuation">)</span>
        cookie <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Auth"</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> <span class="token string">"Pass"</span><span class="token punctuation">,</span> Path<span class="token punctuation">:</span> <span class="token string">"/"</span><span class="token punctuation">}</span>
        http<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span>
        <span class="token function">h</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithBasicAuth</span><span class="token punctuation">(</span>h http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"---&gt;WithBasicAuth()"</span><span class="token punctuation">)</span>
        cookie<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Cookie</span><span class="token punctuation">(</span><span class="token string">"Auth"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">||</span> cookie<span class="token punctuation">.</span>Value <span class="token operator">!=</span> <span class="token string">"Pass"</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">WriteHeader</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusForbidden<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token function">h</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithDebugLog</span><span class="token punctuation">(</span>h http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"---&gt;WithDebugLog"</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span><span class="token function">ParseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Form<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"scheme"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Scheme<span class="token punctuation">)</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Form<span class="token punctuation">[</span><span class="token string">"url_long"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>Form <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"key:"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"val:"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">h</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">hello</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Recieved Request %s from %s\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">,</span> r<span class="token punctuation">.</span>RemoteAddr<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"Hello, World! "</span><span class="token operator">+</span>r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/v1/hello"</span><span class="token punctuation">,</span> <span class="token function">WithServerHeader</span><span class="token punctuation">(</span><span class="token function">WithAuthCookie</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/v2/hello"</span><span class="token punctuation">,</span> <span class="token function">WithServerHeader</span><span class="token punctuation">(</span><span class="token function">WithBasicAuth</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/v3/hello"</span><span class="token punctuation">,</span> <span class="token function">WithServerHeader</span><span class="token punctuation">(</span><span class="token function">WithBasicAuth</span><span class="token punctuation">(</span><span class="token function">WithDebugLog</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"ListenAndServe: "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|1888">
                                <div class="section-title"><h3 id="id-352">多个修饰器的 Pipeline</h3></div>
                                <div class="section-body">
                                    <p>需要先写一个工具函数——用来遍历并调用各个 decorator：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> HttpHandlerDecorator <span class="token keyword">func</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc

<span class="token keyword">func</span> <span class="token function">Handler</span><span class="token punctuation">(</span>h http<span class="token punctuation">.</span>HandlerFunc<span class="token punctuation">,</span> decors <span class="token operator">...</span>HttpHandlerDecorator<span class="token punctuation">)</span> http<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> decors <span class="token punctuation">{</span>
        d <span class="token operator">:=</span> decors<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>decors<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token comment">// iterate in reverse</span>
        h <span class="token operator">=</span> <span class="token function">d</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> h
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style="">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/v4/hello"</span><span class="token punctuation">,</span> <span class="token function">Handler</span><span class="token punctuation">(</span>hello<span class="token punctuation">,</span>
                WithServerHeader<span class="token punctuation">,</span> WithBasicAuth<span class="token punctuation">,</span> WithDebugLog<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|2160">
                                <div class="section-title"><h3 id="id-353">泛型的修饰器</h3></div>
                                <div class="section-body">
                                    <p>下面是我用 reflection 机制写的一个比较通用的修饰器（为了便于阅读，我删除了出错判断代码）</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">Decorator</span><span class="token punctuation">(</span>decoPtr<span class="token punctuation">,</span> fn <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> decoratedFunc<span class="token punctuation">,</span> targetFunc reflect<span class="token punctuation">.</span>Value

    decoratedFunc <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>decoPtr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    targetFunc <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>

    v <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">MakeFunc</span><span class="token punctuation">(</span>targetFunc<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">func</span><span class="token punctuation">(</span>in <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token punctuation">(</span>out <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"before"</span><span class="token punctuation">)</span>
                out <span class="token operator">=</span> targetFunc<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span>
                fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"after"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

    decoratedFunc<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上面的代码动用了 <code>reflect.MakeFunc()</code> 函数制出了一个新的函数其中的 <code>targetFunc.Call(in)</code> 调用了被修饰的函数。</p>
<p>上面这个 <code>Decorator()</code> 需要两个参数，</p>
<ul><li>  第一个是出参 <code>decoPtr</code> ，就是完成修饰后的函数
</li><li>  第二个是入参 <code>fn</code> ，就是需要修饰的函数
</li></ul>
<p>首先假设我们有两个需要修饰的函数：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">foo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%d, %d, %d \n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">bar</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s, %s \n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>
</code></pre>
<p>然后，我们可以这样做：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> MyFoo <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
<span class="token keyword">var</span> myfoo MyFoo
<span class="token function">Decorator</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>myfoo<span class="token punctuation">,</span> foo<span class="token punctuation">)</span>
<span class="token function">myfoo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre>
<p>你会发现，使用 <code>Decorator()</code> 时，还需要先声明一个函数签名。如果你不想声明函数签名，那么你也可以这样：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style="">mybar <span class="token operator">:=</span> bar
<span class="token function">Decorator</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mybar<span class="token punctuation">,</span> bar<span class="token punctuation">)</span>
<span class="token function">mybar</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">,</span> <span class="token string">"world!"</span><span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>
                            </div>
                            

                            <div class="h2-section" >
                                <div class="h2-section-title"><h2 id="id-358">Pipeline</h2></div>
                                
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-355">HTTP 处理</h3></div>
                                <div class="section-body">
                                    <p>上一章节中提到：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style="">http<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">"/v4/hello"</span><span class="token punctuation">,</span> <span class="token function">Handler</span><span class="token punctuation">(</span>hello<span class="token punctuation">,</span>
                WithServerHeader<span class="token punctuation">,</span> WithBasicAuth<span class="token punctuation">,</span> WithDebugLog<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-356">Channel 管理</h3></div>
                                <div class="section-body">
                                    <h4>Channel 转发函数</h4>
<p>首先，我们需一个 <code>echo()</code>函数，其会把一个整型数组放到一个<code>Channel</code>中，并返回这个<code>Channel</code></p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">echo</span><span class="token punctuation">(</span>nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> nums <span class="token punctuation">{</span>
      out <span class="token operator">&lt;-</span> n
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre>
<p>然后，我们依照这个模式，我们可以写下这个函数。</p>
<h4>平方函数</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">sq</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
      out <span class="token operator">&lt;-</span> n <span class="token operator">*</span> n
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre>
<h4>过滤奇数函数</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">odd</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
      <span class="token keyword">if</span> n<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        out <span class="token operator">&lt;-</span> n
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre>
<h4>求和函数</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">sum</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
      sum <span class="token operator">+=</span> n
    <span class="token punctuation">}</span>
    out <span class="token operator">&lt;-</span> sum
    <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre>
<h4>组合</h4>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">sq</span><span class="token punctuation">(</span><span class="token function">odd</span><span class="token punctuation">(</span><span class="token function">echo</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上面的代码类似于我们执行了<code>Unix/Linux</code>命令： <code>echo $nums | sq | sum</code></p>
<p>如果你不想有那么多的函数嵌套，你可以使用一个代理函数来完成：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> EchoFunc <span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
<span class="token keyword">type</span> PipeFunc <span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">pipeline</span><span class="token punctuation">(</span>nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> echo EchoFunc<span class="token punctuation">,</span> pipeFns <span class="token operator">...</span> PipeFunc<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> <span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  ch  <span class="token operator">:=</span> <span class="token function">echo</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> pipeFns <span class="token punctuation">{</span>
    ch <span class="token operator">=</span> pipeFns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ch
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">var</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">pipeline</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> gen<span class="token punctuation">,</span> odd<span class="token punctuation">,</span> sq<span class="token punctuation">,</span> sum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|0|222">
                                <div class="section-title"><h3 id="id-357">Fan in/Out</h3></div>
                                <div class="section-body">
                                    <p>动用<code>Go</code>语言的 <code>Go Routine</code>和 <code>Channel</code>还有一个好处，就是可以写出<code>1</code>对多，或多对<code>1</code>的<code>pipeline</code>，也就是<code>Fan In/ Fan Out</code>。下面，我们来看一个<code>Fan in</code>的示例：</p>
<p>我们想通过并发的方式来对一个很长的数组中的质数进行求和运算，我们想先把数组分段求和，然后再把其集中起来。</p>
<p>主函数：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">makeRange</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> max <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span>
  a <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> max<span class="token operator">-</span>min<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> a <span class="token punctuation">{</span>
    a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> min <span class="token operator">+</span> i
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> a
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  nums <span class="token operator">:=</span> <span class="token function">makeRange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
  in <span class="token operator">:=</span> <span class="token function">echo</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>

  <span class="token keyword">const</span> nProcess <span class="token operator">=</span> <span class="token number">5</span>
  <span class="token keyword">var</span> chans <span class="token punctuation">[</span>nProcess<span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> chans <span class="token punctuation">{</span>
    chans<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">prime</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span>chans<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>prime()</code> 函数：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">is_prime</span><span class="token punctuation">(</span>value <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token function">int</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span><span class="token function">float64</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> value<span class="token operator">%</span>i <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token boolean">false</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> value <span class="token operator">&gt;</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">prime</span><span class="token punctuation">(</span>in <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
 out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
 <span class="token keyword">go</span> <span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
   <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> in <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token function">is_prime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       out <span class="token operator">&lt;-</span> n
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre>
<ul><li>  我们先制造了从<code>1</code>到<code>10000</code>的一个数组，
</li><li>  然后，把这堆数组全部 <code>echo</code>到一个<code>channel</code>里 – <code>in</code>
</li><li>  此时，生成 <code>5</code> 个 <code>Channel</code>，然后都调用 <code>sum(prime(in))</code> ，于是每个<code>Sum</code>的<code>Go Routine</code>都会开始计算和
</li><li>  最后再把所有的结果再求和拼起来，得到最终的结果。
</li></ul>
<p><code>merge</code>代码：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">merge</span><span class="token punctuation">(</span>cs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
  out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>

  wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> c <span class="token operator">:=</span> <span class="token keyword">range</span> cs <span class="token punctuation">{</span>
    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token keyword">range</span> c <span class="token punctuation">{</span>
        out <span class="token operator">&lt;-</span> n
      <span class="token punctuation">}</span>
      wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">close</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> out
<span class="token punctuation">}</span>
</code></pre>
<p>整体流程：</p>
<pre class="language- language-none" tabindex="0"><code class="language- language-none" style="">[]int -&gt; echo -&gt; 多个{prime-&gt;sum} -&gt; merge -&gt; int

</code></pre>
                                </div>
                            </div>
                            </div>
                            

                <div class="h2-section" >
                    <div class="h2-section-title"><h2 id="id-362">泛型编程</h2></div>
                    
                            <div class="sheet-section"  data-position="580|0|42">
                                <div class="section-title"><h3 id="id-359"></h3></div>
                                <div class="section-body">
                                    <p>Go 语言的 1.17 版本发布了，其中开始正式支持泛型了，但还有一些限制（比如，不能把泛型函数 export）。</p>
                                </div>
                            </div>

                            <div class="sheet-section"  data-position="580|600|42">
                                <div class="section-title"><h3 id="id-360">初探</h3></div>
                                <div class="section-body">
                                    <pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token builtin">print</span><span class="token punctuation">[</span>T any<span class="token punctuation">]</span> <span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  strs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"World"</span><span class="token punctuation">,</span>  <span class="token string">"Generics"</span><span class="token punctuation">}</span>
  decs <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float64</span><span class="token punctuation">{</span><span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token number">1.14</span><span class="token punctuation">,</span> <span class="token number">1.618</span><span class="token punctuation">,</span> <span class="token number">2.718</span> <span class="token punctuation">}</span>
  nums <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">}</span>

  <span class="token function">print</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span>
  <span class="token function">print</span><span class="token punctuation">(</span>decs<span class="token punctuation">)</span>
  <span class="token function">print</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上面这个示例中，我们泛型的 <code>print()</code> 支持了三种类型的适配—— <code>int</code>型，<code>float64</code>型，和 <code>string</code>型。要让这段程序跑起来需要在编译行上加上 <code>-gcflags=-G=3</code>编译参数（这个编译参数会在<code>1.18</code>版上成为默认参数），如下所示：</p>
<pre class="language-shell" tabindex="0"><code class="language-shell" style="">go run -gcflags<span class="token operator">=</span>-G<span class="token operator">=</span><span class="token number">3</span> ./main.go
</code></pre>
<p>有了个操作以后，我们就可以写一些标准的算法了，比如，一个查找的算法</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> find<span class="token punctuation">[</span>T comparable<span class="token punctuation">]</span> <span class="token punctuation">(</span>arr <span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">,</span> elem T<span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
    <span class="token keyword">if</span>  v <span class="token operator">==</span> elem <span class="token punctuation">{</span>
      <span class="token keyword">return</span> i
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Go 语言的泛型已基本可用了，只不过，还有三个问题：</p>
<ul><li>  一个是 <code>fmt.Printf()</code>中的泛型类型是 <code>%v</code> 还不够好，不能像<code>c++ iostream</code>重载 <code>&gt;&gt;</code> 来获得程序自定义的输出。
</li><li>  另外一个是，<code>go</code>不支持操作符重载，所以，你也很难在泛型算法中使用“泛型操作符”如：<code>==</code>&nbsp; 等
</li><li>  最后一个是，上面的 <code>find()</code> 算法依赖于“数组”，对于<code>hash-table</code>、<code>tree</code>、<code>graph</code>、<code>link</code>等数据结构还要重写。也就是说，没有一个像<code>C++ STL</code>那样的一个泛型迭代器（这其中的一部分工- 作当然也需要通过重载操作符（如：<code>++</code> 来实现）
</li></ul>
                                </div>
                            </div>

                <div class="sheet-section"  data-position="580|0|139">
                    <div class="section-title"><h3 id="id-361">数据结构</h3></div>
                    <div class="section-body">
                        <h4>Stack 栈</h4>
<p>编程支持泛型最大的优势就是可以实现类型无关的数据结构，下面，我们用<code>Slices</code>这个结构体来实现一个<code>Stack</code>的数结构。</p>
<p>首先，我们可以定义一个泛型的<code>Stack</code>：</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">type</span> stack <span class="token punctuation">[</span>T any<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>T
</code></pre>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>stack<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">push</span><span class="token punctuation">(</span>elem T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">,</span> elem<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>stack<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>stack<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>T<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>stack<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>stack<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> elem <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token operator">*</span>s <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>top()</code>之前，我们返回的“空”值，要么是 <code>int</code> 的<code>0</code>，要么是 <code>string</code> 的 “”，然而在泛型的<code>T</code>下，这个值就不容易搞了。也就是说，除了类型泛型后，还需要有一些“值的泛型”（注：在<code>C++</code>中，如果你要用一个空栈进行 <code>top()</code> 操作，你会得到一个 <code>segmentation fault</code>），所以，这里我们返回的是一个指针，这样可以判断一下指针是否为空。</p>
<pre class="language-go" tabindex="0"><code class="language-go" style=""><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

 ss <span class="token operator">:=</span> stack<span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
 ss<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span>
 ss<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Hao"</span><span class="token punctuation">)</span>
 ss<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Chen"</span><span class="token punctuation">)</span>
 ss<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"stack top is - %v\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 ss<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 ss<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 ss<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


 ns <span class="token operator">:=</span> stack<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
 ns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
 ns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
 ns<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 ns<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 ns<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token operator">*</span>ns<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+=</span> <span class="token number">1</span>
 ns<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 ns<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"stack top is - %v\n"</span><span class="token punctuation">,</span> ns<span class="token punctuation">.</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre>
                    </div>
                </div>
                </div>
                
            </div>
            <div id="sheet-nav">
        <div class="nav-wrapper">
            <div class="nav-btn">
                <div class="nav-btn__item nav-btn-top">顶</div>
                <div class="nav-btn__item nav-btn-menu">菜</div>
            </div>
            <div class="nav-content hide">
                    <div class="nav-item nav-type-H3 hide" title="Credits" data-id="id-272" data-pid="default">
                    <span class="next-ctrl"></span> Credits
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="简述" data-id="id-273" data-pid="default">
                    <span class="next-ctrl"></span> 简述
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Hello World" data-id="id-274" data-pid="default">
                    <span class="next-ctrl"></span> Hello World
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="操作符" data-id="id-279" data-pid="">
                    <span class="next-ctrl">+</span> 操作符
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="算术运算" data-id="id-275" data-pid="id-279">
                    <span class="next-ctrl"></span> 算术运算
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="对比" data-id="id-276" data-pid="id-279">
                    <span class="next-ctrl"></span> 对比
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="逻辑运算" data-id="id-277" data-pid="id-279">
                    <span class="next-ctrl"></span> 逻辑运算
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="其他" data-id="id-278" data-pid="id-279">
                    <span class="next-ctrl"></span> 其他
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="变量声明" data-id="id-281" data-pid="">
                    <span class="next-ctrl">+</span> 变量声明
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="函数" data-id="id-287" data-pid="">
                    <span class="next-ctrl">+</span> 函数
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="init()函数" data-id="id-282" data-pid="id-287">
                    <span class="next-ctrl"></span> init()函数
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="main()函数" data-id="id-283" data-pid="id-287">
                    <span class="next-ctrl"></span> main()函数
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="函数定义" data-id="id-284" data-pid="id-287">
                    <span class="next-ctrl"></span> 函数定义
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="函数作为值和闭包" data-id="id-285" data-pid="id-287">
                    <span class="next-ctrl"></span> 函数作为值和闭包
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="可变参数函数" data-id="id-286" data-pid="id-287">
                    <span class="next-ctrl"></span> 可变参数函数
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="类型" data-id="id-293" data-pid="">
                    <span class="next-ctrl">+</span> 类型
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="内置类型" data-id="id-288" data-pid="id-293">
                    <span class="next-ctrl"></span> 内置类型
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="内置函数" data-id="id-289" data-pid="id-293">
                    <span class="next-ctrl"></span> 内置函数
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="结构 Struct" data-id="id-290" data-pid="id-293">
                    <span class="next-ctrl"></span> 结构 Struct
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="指针" data-id="id-291" data-pid="id-293">
                    <span class="next-ctrl"></span> 指针
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="类型转换" data-id="id-292" data-pid="id-293">
                    <span class="next-ctrl"></span> 类型转换
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="Packages" data-id="id-295" data-pid="">
                    <span class="next-ctrl">+</span> Packages
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="控制结构" data-id="id-299" data-pid="">
                    <span class="next-ctrl">+</span> 控制结构
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="If" data-id="id-296" data-pid="id-299">
                    <span class="next-ctrl"></span> If
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Loops" data-id="id-297" data-pid="id-299">
                    <span class="next-ctrl"></span> Loops
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Switch" data-id="id-298" data-pid="id-299">
                    <span class="next-ctrl"></span> Switch
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="集合" data-id="id-304" data-pid="">
                    <span class="next-ctrl">+</span> 集合
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="数组" data-id="id-300" data-pid="id-304">
                    <span class="next-ctrl"></span> 数组
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="切片" data-id="id-301" data-pid="id-304">
                    <span class="next-ctrl"></span> 切片
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="操作数组和切片" data-id="id-302" data-pid="id-304">
                    <span class="next-ctrl"></span> 操作数组和切片
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Maps" data-id="id-303" data-pid="id-304">
                    <span class="next-ctrl"></span> Maps
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="多态" data-id="id-307" data-pid="">
                    <span class="next-ctrl">+</span> 多态
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="接口" data-id="id-305" data-pid="id-307">
                    <span class="next-ctrl"></span> 接口
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="嵌入" data-id="id-306" data-pid="id-307">
                    <span class="next-ctrl"></span> 嵌入
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="并发" data-id="id-311" data-pid="">
                    <span class="next-ctrl">+</span> 并发
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Goroutines" data-id="id-308" data-pid="id-311">
                    <span class="next-ctrl"></span> Goroutines
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Channels" data-id="id-309" data-pid="id-311">
                    <span class="next-ctrl"></span> Channels
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Channel Axioms" data-id="id-310" data-pid="id-311">
                    <span class="next-ctrl"></span> Channel Axioms
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="杂项" data-id="id-316" data-pid="">
                    <span class="next-ctrl">+</span> 杂项
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="错误" data-id="id-312" data-pid="id-316">
                    <span class="next-ctrl"></span> 错误
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="打印" data-id="id-313" data-pid="id-316">
                    <span class="next-ctrl"></span> 打印
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="反射 - 类型 Switch" data-id="id-314" data-pid="id-316">
                    <span class="next-ctrl"></span> 反射 - 类型 Switch
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="HTTP Server" data-id="id-315" data-pid="id-316">
                    <span class="next-ctrl"></span> HTTP Server
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="编程模式" data-id="id-322" data-pid="">
                    <span class="next-ctrl">+</span> 编程模式
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="深度比较" data-id="id-317" data-pid="id-322">
                    <span class="next-ctrl"></span> 深度比较
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="接口编程" data-id="id-318" data-pid="id-322">
                    <span class="next-ctrl"></span> 接口编程
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="接口完整性检查" data-id="id-319" data-pid="id-322">
                    <span class="next-ctrl"></span> 接口完整性检查
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="时间" data-id="id-320" data-pid="id-322">
                    <span class="next-ctrl"></span> 时间
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="性能提示" data-id="id-321" data-pid="id-322">
                    <span class="next-ctrl"></span> 性能提示
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="错误处理" data-id="id-328" data-pid="">
                    <span class="next-ctrl">+</span> 错误处理
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="多个不同类型的 error：" data-id="id-324" data-pid="id-328">
                    <span class="next-ctrl"></span> 多个不同类型的 error：
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="defer 关键词进行资源清理" data-id="id-325" data-pid="id-328">
                    <span class="next-ctrl"></span> defer 关键词进行资源清理
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="优雅的错误检查" data-id="id-326" data-pid="id-328">
                    <span class="next-ctrl"></span> 优雅的错误检查
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="包装错误" data-id="id-327" data-pid="id-328">
                    <span class="next-ctrl"></span> 包装错误
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="函数式编程" data-id="id-332" data-pid="">
                    <span class="next-ctrl">+</span> 函数式编程
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Builder 模式" data-id="id-330" data-pid="id-332">
                    <span class="next-ctrl"></span> Builder 模式
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Functional Options" data-id="id-331" data-pid="id-332">
                    <span class="next-ctrl"></span> Functional Options
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="委托和反转控制" data-id="id-335" data-pid="">
                    <span class="next-ctrl">+</span> 委托和反转控制
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="委托" data-id="id-333" data-pid="id-335">
                    <span class="next-ctrl"></span> 委托
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="翻转控制" data-id="id-334" data-pid="id-335">
                    <span class="next-ctrl"></span> 翻转控制
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="MAP-REDUCE" data-id="id-344" data-pid="">
                    <span class="next-ctrl">+</span> MAP-REDUCE
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Map" data-id="id-336" data-pid="id-344">
                    <span class="next-ctrl"></span> Map
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Reduce" data-id="id-337" data-pid="id-344">
                    <span class="next-ctrl"></span> Reduce
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Filter" data-id="id-338" data-pid="id-344">
                    <span class="next-ctrl"></span> Filter
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Map-Reduce 与 泛型" data-id="id-339" data-pid="id-344">
                    <span class="next-ctrl"></span> Map-Reduce 与 泛型
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="简单版 Generic Map" data-id="id-340" data-pid="id-344">
                    <span class="next-ctrl"></span> 简单版 Generic Map
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="健壮版的 Generic Map" data-id="id-341" data-pid="id-344">
                    <span class="next-ctrl"></span> 健壮版的 Generic Map
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="健壮版的 Generic Reduce" data-id="id-342" data-pid="id-344">
                    <span class="next-ctrl"></span> 健壮版的 Generic Reduce
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="健壮版的 Generic Filter" data-id="id-343" data-pid="id-344">
                    <span class="next-ctrl"></span> 健壮版的 Generic Filter
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="GO GENERATION" data-id="id-349" data-pid="">
                    <span class="next-ctrl">+</span> GO GENERATION
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="类型检查" data-id="id-345" data-pid="id-349">
                    <span class="next-ctrl"></span> 类型检查
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Go Generator" data-id="id-346" data-pid="id-349">
                    <span class="next-ctrl"></span> Go Generator
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="新版 Filter" data-id="id-347" data-pid="id-349">
                    <span class="next-ctrl"></span> 新版 Filter
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="第三方工具" data-id="id-348" data-pid="id-349">
                    <span class="next-ctrl"></span> 第三方工具
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="修饰器" data-id="id-354" data-pid="">
                    <span class="next-ctrl">+</span> 修饰器
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="简单示例" data-id="id-350" data-pid="id-354">
                    <span class="next-ctrl"></span> 简单示例
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="HTTP 相关的一个示例" data-id="id-351" data-pid="id-354">
                    <span class="next-ctrl"></span> HTTP 相关的一个示例
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="多个修饰器的 Pipeline" data-id="id-352" data-pid="id-354">
                    <span class="next-ctrl"></span> 多个修饰器的 Pipeline
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="泛型的修饰器" data-id="id-353" data-pid="id-354">
                    <span class="next-ctrl"></span> 泛型的修饰器
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="Pipeline" data-id="id-358" data-pid="">
                    <span class="next-ctrl">+</span> Pipeline
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="HTTP 处理" data-id="id-355" data-pid="id-358">
                    <span class="next-ctrl"></span> HTTP 处理
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Channel 管理" data-id="id-356" data-pid="id-358">
                    <span class="next-ctrl"></span> Channel 管理
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="Fan in/Out" data-id="id-357" data-pid="id-358">
                    <span class="next-ctrl"></span> Fan in/Out
                    </div>
                
                    <div class="nav-item nav-type-H2 " title="泛型编程" data-id="id-362" data-pid="">
                    <span class="next-ctrl">+</span> 泛型编程
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="初探" data-id="id-360" data-pid="id-362">
                    <span class="next-ctrl"></span> 初探
                    </div>
                
                    <div class="nav-item nav-type-H3 hide" title="数据结构" data-id="id-361" data-pid="id-362">
                    <span class="next-ctrl"></span> 数据结构
                    </div>
                </div>
        </div>
        </div>
        </div></div>

    
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0200265368172615" crossorigin="anonymous"></script>



<script src="../js/util/function.js?version=2021082402"></script><script src="../js/util/event-hub.js?version=2021082402"></script><script src="../js/3rdparty/prism.js?version=2021082402"></script><script src="../js/module/loading.js?version=2021082402"></script><script src="../js/module/home.js?version=2021082402"></script><script src="../js/module/cheatsheet.js?version=2021082402"></script><script src="../js/module/menu.js?version=2021082402"></script><script src="../js/3rdparty/jszip.min.js?version=2021082402"></script><script src="../js/util/saveData.js?version=2021082402"></script></body></html>